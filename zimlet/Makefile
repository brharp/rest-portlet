
ZIMLET_NAME=gimlet
ZIMLET_DEFINITION_FILE=${ZIMLET_NAME}.xml
ZIMLET_PACKAGE_FILE=${ZIMLET_NAME}.zip
ZIMLET_SCRIPT_FILE=${ZIMLET_NAME}.js
ZIMLET_CONF_FILE=config_template.xml
ZIMLET_PROPS_FILE=${ZIMLET_NAME}.properties
ZIMLET_JSP_FILE=snoop.jsp
ZIMLET_JARS=portlet-api_2.0_spec-1.0.jar rest-remote-portlet.jar
ZIMLET_SOURCES=${ZIMLET_DEFINITION_FILE} ${ZIMLET_SCRIPT_FILE} ${ZIMLET_CONF_FILE} ${ZIMLET_PROPS_FILE} ${ZIMLET_JSP_FILE}

ZIMBRA_USER=zimbra
ZMZIMLETCTL=/opt/zimbra/bin/zmzimletctl
DEPLOY=deploy
UNDEPLOY=undeploy

${ZIMLET_PACKAGE_FILE}: ${ZIMLET_SOURCES} ${ZIMLET_JARS}
	zip $@ ${ZIMLET_SOURCES} ${ZIMLET_JARS}

deploy: ${ZIMLET_PACKAGE_FILE}
	sudo -u ${ZIMBRA_USER} ${ZMZIMLETCTL} ${DEPLOY} ${ZIMLET_PACKAGE_FILE}

undeploy: ${ZIMLET_PACKAGE_FILE}
	sudo -u ${ZIMBRA_USER} ${ZMZIMLETCTL} ${UNDEPLOY} ${ZIMLET_PACKAGE_FILE}
